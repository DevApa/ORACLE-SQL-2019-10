ALUMNA: MARIA HUACHACA CUELLAR
ALUMNO: JAIME LUIS ROJAS FLORES

-- CREAR USUARIO

CREATE USER DISTRIBUIDOR
IDENTIFIED BY ADMIN;

-- DAR RECURSOS

GRANT CONNECT, RESOURCE TO DISTRIBUIDOR;

CREATE TABLE CAMIONERO(
CEDULA VARCHAR(10) PRIMARY KEY,
NOMBRE VARCHAR(50),
TELEFONO VARCHAR(15),
DIRECCIÓN VARCHAR(20),
SALARIO DECIMAL(8,2),
POBLACIÓN VARCHAR(15)
);
/

CREATE TABLE CAMION(
MATRICULA VARCHAR(10) PRIMARY KEY,
MODELO VARCHAR(15),
TIPO VARCHAR(15),
POTENCIA VARCHAR(10)
);
/

CREATE TABLE CONDUCE(
CEDULA_CAMIONERO VARCHAR(10),
MATRICULA_CAMION VARCHAR(10),
FECHA DATE,
FOREIGN KEY(CEDULA_CAMIONERO) REFERENCES
CAMIONERO (CEDULA),
FOREIGN KEY (MATRICULA_CAMION) REFERENCES
CAMION (MATRICULA),
PRIMARY KEY(CEDULA_CAMIONERO,
MATRICULA_CAMION, FECHA)
);
/

CREATE TABLE PROVINCIA(
COD_PROVINCIA VARCHAR(10) PRIMARY KEY,
NOMBRE VARCHAR(15)
);
/

CREATE TABLE PAQUETE(
COD_PAQUETE VARCHAR(10) PRIMARY KEY,
DESCRIPCION VARCHAR(30),
DESTINATARIO VARCHAR(50),
DIRECCION_DESTINATARIO VARCHAR(20),
CEDULA_CAMIONERO VARCHAR(10),
PROVINCIA_DESTINO VARCHAR(10),
FOREIGN KEY (CEDULA_CAMIONERO) REFERENCES
CAMIONERO (CEDULA),
FOREIGN KEY (PROVINCIA_DESTINO) REFERENCES
PROVINCIA (COD_PROVINCIA)
);
/
-- INSERCION DE DATOS
--1era forma 
INSERT INTO CAMIONERO VALUES('1', 'Jefferson Gomez', '991808117', 'calle Rios 35', 
'100000', 'Wanta');
INSERT INTO CAMIONERO VALUES('2', 'Carlos cuellar', '991808118', 'calle Rios 68', 
'900000', 'Wanta');
INSERT INTO CAMIONERO VALUES('3', 'Carlos Diaz', '991808118', 'calle Rios 67', 
'900000', 'Wanta');
INSERT INTO CAMIONERO VALUES('4', 'Carlos Caceres', '991808118', 'calle Rios 67', 
'900000', 'Wanta');
INSERT INTO CAMIONERO VALUES('5', 'Carla Huaman', '991808118', 'calle Rios 67', 
'900000', 'San Francisco');
INSERT INTO CAMIONERO VALUES('6', 'Kety Jesus', '991808118', 'calle Rios 67', 
'900000', 'San Francisco');
INSERT INTO CAMIONERO VALUES('7', 'David Benites', '991808115', 'calle San Juan 68', 
'150000', 'Cuzco-wanta2');

INSERT INTO CAMIONERO VALUES('9', 'Milagros Palomino', '912349678', 'calle Diaz 48', 
'5000', 'San Francisco');
INSERT INTO CAMIONERO VALUES('10', 'Katy Alfaro', '912349677', 'calle Diaz 49', 
'5000', null);

-- 2da forma
INSERT INTO DISTRIBUIDOR.CAMIONERO (CEDULA, NOMBRE, TELEFONO, DIRECCIÓN,
SALARIO, POBLACIÓN)
     VALUES ('12','LINA HUACHACA CUELLAR','987856548','Jiron puno','5000','San Sebastian');

INSERT INTO CAMION VALUES('FK-1010', 'MODE_MM', 'T_PP', '13 CF');
INSERT INTO CAMION VALUES('FK-1011', 'MODE_MM', 'T_PP', '14 CF');
INSERT INTO CAMION VALUES('FK-1012', 'MODE_MM', 'T_PP', '15 CF');
INSERT INTO CAMION VALUES('FK-1013', 'MODE_MM', 'T_PP', '16 CF');
INSERT INTO CAMION VALUES('FK-1014', 'MODE_MM', 'T_PP', '17 CF');
INSERT INTO CAMION VALUES('FK-1015', 'MODE_MM', 'T_PP', '18 CF');
INSERT INTO CAMION VALUES('FK-1016', 'MODE_HH', 'T_CC', '19 CD');
INSERT INTO CAMION VALUES('FK-1017', 'MODE_HH', 'T_CC', '20 CD');
INSERT INTO CAMION VALUES('FK-1018', 'MODE_HH', 'T_CC', '21 CD');
INSERT INTO CAMION VALUES('FK-1019', 'MODE_HH', 'T_CC', '22 CD');


INSERT INTO CONDUCE VALUES('1', 'FK-1010', '02-09-2019');
INSERT INTO CONDUCE VALUES('2', 'FK-1011', '08-09-2019');
INSERT INTO CONDUCE VALUES('3', 'FK-1012', '19-09-2019');
INSERT INTO CONDUCE VALUES('4', 'FK-1013', '20-09-2019');

INSERT INTO PROVINCIA VALUES('8080', 'CUZCO');
INSERT INTO PROVINCIA VALUES('8081', 'ABANCAY');
INSERT INTO PROVINCIA VALUES('8082', 'APURIMAC');
INSERT INTO PROVINCIA VALUES('8083', 'HUANCAYO');
INSERT INTO PROVINCIA VALUES('8084', 'LORETO');


INSERT INTO PAQUETE VALUES('1', 'CAJA CON MERCANCIAS', 'JEFFERSON GOMEZ','CALLE 56 #67-33','1','8080');
INSERT INTO PAQUETE VALUES('2', 'CAJA CON MERCANCIAS', 'CARLOS CUELLAR','CALLE 56 #67-33','2','8081');
INSERT INTO PAQUETE VALUES('3', 'CAJA CON MERCANCIAS', 'CARLOS DIAZ','CALLE 56 #67-33','3','8082');
INSERT INTO PAQUETE VALUES('4', 'CAJA CON MERCANCIAS', 'CARLOS CACERES','CALLE 56 #67-33','4','8083');
INSERT INTO PAQUETE VALUES('5', 'CAJA CON MERCANCIAS', 'CARLA HUAMAN','CALLE 56 #67-33','5','8084');

-- 1. CONSULTA SIMPLE
SELECT * FROM CAMIONERO;
SELECT * FROM CAMION;
SELECT * FROM CONDUCE;
SELECT * FROM PROVINCIA;
SELECT * FROM PAQUETE;

/*--2. Desarrolle una sentencia SELECT para consultar el CELULA, nombre, teléfono a la 
 tabla camionero de Esquema DISTRIBUIDOR.*/ 

select CEDULA , NOMBRE, TELEFONO
from DISTRIBUIDOR.CAMIONERO;


/*--3. Desarrolle una sentencia SELECT para consultar el CELULA, nombre, teléfono a la 
 tabla camionero de Esquema DISTRIBUIDOR.*/ 

select COD_PAQUETE, DIRECCION_DESTINATARIO, PROVINCIA_DESTINO
from DISTRIBUIDOR.PAQUETE;


/*4.Desarrollar una sentencia SELECT que permita consultar el salario, y el salario 
proyectado con un aumento del 15% de cada empleado de Esquema CAMIONERO.*/

SELECT 
    CEDULA || ', ' || NOMBRE "NOMBRE TOTAL",
    SALARIO, SALARIO * 1.15 "SUELDO PROYECTADO"
FROM DISTRIBUIDOR.CAMIONERO; 

/*
5. Consultar la fecha que conducieron o salieron a la provincia. Esquema CONDUCE.
*/

SELECT CEDULA_CAMIONERO, FECHA
FROM  DISTRIBUIDOR.CONDUCE;

/* 6. Desarrollar una sentencia SELECT que permita consultar los empleados que su 
nombre finaliza con la letra "s" o "n". Esquema CAMIONERO.*/

SELECT * FROM DISTRIBUIDOR.CAMIONERO
WHERE NOMBRE LIKE '%s';


SELECT * FROM DISTRIBUIDOR.CAMIONERO
WHERE substr(NOMBRE,-1) = 's';

SELECT * FROM DISTRIBUIDOR.CAMIONERO
WHERE NOMBRE LIKE '%n';

/* 7. BUSCAR CON BETWEEN NOMBRE DE LOS CAMIONERES DE LETRA D HASTA F. Esquema CAMIONERO.UTILICE LA SIGUIENTE Sintaxis: COLUMNA [NOT] BETWEEN VALOR1 AND VALOR2*/

SELECT * 
FROM DISTRIBUIDOR.CAMIONERO
WHERE NOMBRE BETWEEN 'D' AND 'F'
ORDER BY 3;

/* 8. ACTUALIZAR  REGISTRO NULO DE ESQUEMA CAMIONERO*/

UPDATE DISTRIBUIDOR.CAMIONERO SET TELEFONO=999994489  WHERE NOMBRE='JUA CARDENAS';

/* 9. INSERTAR REGISTRO CON VALORES NULOS A ESQUEMA CAMIONERO*/

INSERT INTO DISTRIBUIDOR.CAMIONERO (CEDULA, NOMBRE, TELEFONO, DIRECCIÓN,
SALARIO, POBLACIÓN)
     VALUES ('13','JUA CARDENAS',null,'Jiron Iquitos 38','8000','Picho alto');

/* 10. Actualizacion de campo si se cumple una condición. Esquema.Caminero*/

UPDATE CAMIONERO SET NOMBRE='PEDRO RAMIREZ DIAZ' WHERE NOMBRE='LINA HUACHACA CUELLAR';

/*11-- Busca el usuario DISTRIBUIDOR y borra todo sus datos*/

DECLARE
  N INT;
  COMMAND VARCHAR2(200);
BEGIN
	SELECT COUNT(*) INTO N
	FROM DBA_USERS
	WHERE USERNAME = 'PPROFESIONAL';
	IF ( N = 1 ) THEN
    COMMAND := 'DROP USER PPROFESIONAL CASCADE';
		EXECUTE IMMEDIATE COMMAND;
	END IF;
END;
/

--OTRAS OPCIONES
--BORRAR UNA ESQUEMA, ESTANDO EN SYSTEM/ORCLE
DROP USER DISTRIBUIDOR CASCADE;

--12.  Eliminar una Tabla
DROP TABLE  DISTRIBUIDOR.CAMIONERO PURGE;

--13.  Contar las filas, tambien aplicar distinct
SELECT COUNT(*) FROM DISTRIBUIDOR.CAMIONERO; 

SELECT COUNT(DISTINCT CEDULA) FROM DISTRIBUIDOR.CAMIONERO;
 

/*14 Desarrolle una consulta para averiguar quiénes son los empleados que tienen el menor 
sueldo. DISTRIBUIDOR.CAMIONERO.*/


SELECT E.*, (SELECT MIN(SALARIO) FROM DISTRIBUIDOR.CAMIONERO) "SUELDO MENOR"
FROM DISTRIBUIDOR.CAMIONERO E
WHERE SALARIO = (SELECT MIN(SALARIO) FROM DISTRIBUIDOR.CAMIONERO);

/*15 Desarrolle una consulta que muestre las siguientes columnas:   
 - cedula del empleado   
 - Nombre del empleado   
 - Salario del empleado   
 - Sueldo promedio en la empresa   
 - Diferencia del sueldo del empleado y el sueldo promedio 
*/

WITH 
V1 AS (SELECT AVG(SALARIO) SALARIO_PROMEDIO FROM DISTRIBUIDOR.CAMIONERO)
SELECT 
    E.CEDULA,
    E.NOMBRE,
    E.SALARIO,
    ROUND(V1.SALARIO_PROMEDIO,2) "SUELDO PROMEDIO",
    ROUND(E.SALARIO - V1.SALARIO_PROMEDIO,2) "DIFERENCIA"
FROM DISTRIBUIDOR.CAMIONERO E CROSS JOIN V1
ORDER BY 3 DESC;



/* 16 Desarrolle CURSOR para que me muestre listado de datos de esquema distribuidor tabla paquete.
*/

DECLARE
  CURSOR CURSOR_1 IS  
         SELECT * FROM PAQUETE;
  R_CEDU  DISTRIBUIDOR.PAQUETE%ROWTYPE;
BEGIN
  OPEN CURSOR_1;
  LOOP
    FETCH CURSOR_1 INTO R_CEDU;
    EXIT WHEN CURSOR_1%NOTFOUND;  
    DBMS_OUTPUT.put_line('COOGO DE PAQUETE: ' || R_CEDU.COD_PAQUETE); 
    DBMS_OUTPUT.put_line('CEDULA: ' || R_CEDU.CEDULA_CAMIONERO);
    DBMS_OUTPUT.put_line('DESCRIPCION DE PAQUETE: ' || R_CEDU.DESCRIPCION);
    
       DBMS_OUTPUT.put_line('---------------------');
  END LOOP;
  CLOSE CURSOR_1;
END;
/


/* 17 Desarrolle CURSOR para guardar esquema distribuidor tabla paquete.
*/

SELECT * FROM DISTRIBUIDOR.CAMIONERO;
CREATE  OR  REPLACE  PROCEDURE DISTRIBUIDOR.UPDATE_SAL(ID_CEDULA  NUMBER,
V_SALARIO  NUMBER) IS
BEGIN
  UPDATE DISTRIBUIDOR.CAMIONERO
  SET  SALARIO  =  SALARIO  +  V_SALARIO
  WHERE CEDULA   =ID_CEDULA  ;
  IF SQL%NOTFOUND  THEN 
     DBMS_OUTPUT.PUT_LINE('NO  EXISTE');
  ELSE
     COMMIT; 
     DBMS_OUTPUT.PUT_LINE('PROCESO  OK');
  END IF; 
END;
/

CALL DISTRIBUIDOR.UPDATE_SAL(2,3500);


Nota.- Puedes ejecutar mas veces y confirmar con commit;
select * from distribuidor.camionero;



/* 18 Actualizacion codigo de paquete de esquema distribuidor.
*/

UPDATE DISTRIBUIDOR.PAQUETE
   SET COD_PAQUETE = 111
 WHERE COD_PAQUETE = 1;
 
 UPDATE DISTRIBUIDOR.PAQUETE
   SET COD_PAQUETE = 113
 WHERE COD_PAQUETE = 3;

--19 Eliminar Registro de la tabla paquete

DELETE DISTRIBUIDOR.PAQUETE
 WHERE COD_PAQUETE = 5;

-- 20 Cuantos departamentos existen en el esquema DISTRIBUIDOR tabla provincia

select *from provincia;

SELECT COD_PROVINCIA, COUNT(1) PROVINCIA
FROM DISTRIBUIDOR.PROVINCIA 
GROUP BY COD_PROVINCIA;



